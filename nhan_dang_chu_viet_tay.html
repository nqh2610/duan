<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nhận diện chữ viết tay từ camera</title>
    <style>
        #video {
            width: 100%;
            height: auto;
        }
        #textarea {
            width: 100%;
            height: 150px;
            margin-top: 10px;
        }
        #startButton {
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>Nhận diện chữ viết tay từ camera</h1>
    <video id="video" autoplay></video>
    <button id="startButton">Bắt đầu nhận diện</button>
    <textarea id="textarea" placeholder="Chữ viết tay sẽ xuất hiện ở đây..."></textarea>

    <script>
        // Thay đổi với API endpoint của MyScript
        const MY_SCRIPT_API_URL = 'https://cloud.myscript.com/api/v4.0/iink/contextlessgesture";;
        const MY_SCRIPT_API_KEY = 'b141e7fd-7694-46b7-aff8-cfdbb112db2f'; // Thay thế với API key của bạn

        // Lấy phần tử video, textarea và nút bắt đầu
        const video = document.getElementById('video');
        const textarea = document.getElementById('textarea');
        const startButton = document.getElementById('startButton');

        // Cấp quyền truy cập camera và hiển thị video
        navigator.mediaDevices.getUserMedia({ video: true })
            .then(stream => {
                video.srcObject = stream;
            })
            .catch(error => {
                console.error('Lỗi khi truy cập camera:', error);
            });

        // Hàm chụp ảnh từ video và nhận diện chữ viết tay
        function captureAndRecognizeText() {
            // Tạo một canvas để chụp ảnh từ video
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            context.drawImage(video, 0, 0, canvas.width, canvas.height);

            // Chuyển canvas thành hình ảnh base64
            const imageData = canvas.toDataURL('image/png');

            // Gửi yêu cầu đến MyScript API
            fetch(MY_SCRIPT_API_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${MY_SCRIPT_API_KEY}`
                },
                body: JSON.stringify({
                    image: imageData,
                    // Thay đổi cấu hình nếu cần
                    language: 'vi' // Ngôn ngữ nhận diện, có thể thay đổi tùy theo nhu cầu
                })
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                console.log('Phản hồi từ API:', data); // Kiểm tra cấu trúc phản hồi
                // Hiển thị văn bản nhận diện được trên textarea
                if (data.results && data.results[0] && data.results[0].text) {
                    textarea.value = data.results[0].text; // Điều chỉnh tùy theo cấu trúc phản hồi của API
                } else {
                    textarea.value = 'Không có văn bản nhận diện được.';
                }
            })
            .catch(error => {
                console.error('Lỗi khi nhận diện chữ viết tay:', error);
            });
        }

        // Thêm sự kiện click cho nút bắt đầu
        startButton.addEventListener('click', captureAndRecognizeText);
    </script>
</body>
</html>
